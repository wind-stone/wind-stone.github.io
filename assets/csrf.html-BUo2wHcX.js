import { r as resolveComponent, c as createElementBlock, b as createStaticVNode, a as createVNode, o as openBlock } from "./app-Dscgj__W.js";
import { _ as _export_sfc } from "./plugin-vue_export-helper-1tPrXgE0.js";
const _sfc_main = {};
function _sfc_render(_ctx, _cache) {
  const _component_global_config = resolveComponent("global-config");
  return openBlock(), createElementBlock("div", null, [
    _cache[0] || (_cache[0] = createStaticVNode('<h1 id="csrf" tabindex="-1"><a class="header-anchor" href="#csrf"><span>CSRF</span></a></h1><p>CSRF（Cross-site request forgery）跨站请求伪造，也被称为“One Click Attack”或者“Session Riding”，通常缩写为 CSRF 或者 XSRF，是一种对网站的恶意利用。尽管听起来像跨站脚本（XSS），但它与XSS非常不同，XSS 利用站点内的信任用户，而 CSRF 则通过伪装来自受信任用户的请求来利用受信任的网站。与 XSS 攻击相比，CSRF 攻击往往不大流行（因此对其进行防范的资源也相当稀少）和难以防范，所以被认为比 XSS 更具危险性。</p><p>CSRF 有两个关键点：</p><ul><li>跨站点的请求：从字面上看，跨站点请求的来源是其他站点，比如，目标网站的删除文章功能接收到来自恶意网站客户端（JavaScript、Flash、HTML等）发出的删除文章请求，这个请求就是跨站点的请求，目标网站应该区分请求来源。字面上的定义总是狭义的，这样恶意的请求也有可能来自本站。</li><li>请求是伪造的：伪造的定义很模糊，一般情况下，我们可以认为：如果请求的发出不是用户的意愿，那么这个请求就是伪造的。而对于 XSS 来说，发起的任何请求实际上都是目标网站同域内发出的，此时已经没有同源策略的限制，虽然这样，我们同样认为这些请求也是伪造的，因为它们不是用户的意愿。</li></ul><h2 id="示例" tabindex="-1"><a class="header-anchor" href="#示例"><span>示例</span></a></h2><p>目标网站 A：<code>www.a.com</code><br> 恶意网站 B：<code>www.b.com</code></p><p>两个域不一样，目标网站 A 上有一个删除文章的功能，通常是用户单击“删除链接”时才会删除指定的文章，这个链接是<code>www.a.com/blog/del?id=1</code>，id 号代表不同的文章。</p><p>我们知道，这样删除文章实际上就是发出一个 GET 请求，那么如果目标网站 A 上存在一个 XSS 漏洞，执行的 JS 脚本无同源策略限制，就可以按下面的方式来删除文章。</p><ul><li>使用 AJAX 发出 GET 请求，请求值是 id = 1，请求目标地址是<code>www.a.com/blog/del</code></li><li>或者动态创建一个标签对象（如 img、iframe、script）等，将它们的 src 指向这个链接<code>www.a.com/blog/del?id=1</code>，发出的也是 GET 请求</li><li>然后欺骗用户访问存在 XSS 脚本的漏洞页面（在目标网站 A 上），则攻击发生</li></ul><p>上述是通过 XSS 漏洞使得 JS 脚本在没有同源策略限制的情况下执行的，即请求时会自动带上会话（Cookie等）。</p><p>如果不用这种方式，或者目标网站 A 根本不存在 XSS 漏洞，还可以如何删除文章？看看 CSRF 的思路，步骤如下：</p><ul><li>在恶意网站 B 上编写一个 CSRF 页面（<code>www.b.com/csrf.html</code>），想想有什么办法可以发出一个 GET 请求到目标网站 A 上？ <ul><li>利用 AJAX 跨域时带上目标域的会话</li><li>更简单的：用代码<code>&lt;img src=&quot;http://www.a.com/blog/del?id=1&quot;&gt;</code></li></ul></li><li>然后欺骗已经登录目标网站 A 的用户访问<code>www.b.com/csrf.html</code>页面，则攻击发生</li></ul><p>这个攻击过程有三个关键点：</p><ul><li>跨域发出了一个 GET 请求</li><li>可以无 JavaScript 参与</li><li>请求是身份认证后的</li></ul><h3 id="跨域发出了一个-get-请求" tabindex="-1"><a class="header-anchor" href="#跨域发出了一个-get-请求"><span>跨域发出了一个 GET 请求</span></a></h3><p>同源策略是用来限制客户端脚本的跨域请求行为，但实际上由客户端 HTML 标签等发出的跨域 GET 请求被认为是合法的，不在同源策略的限制中，但是这个请求发出后并没有能力得到目标页面响应的数据内容。</p><p>很多网站其实都需要这样的功能，比如，嵌入第三方资源：图片、JS 脚本，CSS 样式、框架内容，尤其是很多开放的 Web 2.0 网站有个 mashup 应用聚合概念，如 Google 的 Gadgets 或者 SNS 社区中的第三方 Web 应用于 Web 游戏，通过 iframe 嵌入第三方扩展应用，如果将这样的 GET 请求限制住，那么 Web 世界就过于封闭了。</p><p>安全风险总是出现在正常的流程中，现在我们发出的是一个删除文章的 GET 请求，对于合法的跨域请求，浏览器会放行。</p><h3 id="可以无-javascript-参与" tabindex="-1"><a class="header-anchor" href="#可以无-javascript-参与"><span>可以无 JavaScript 参与</span></a></h3><p>CSRF 这个过程与 XSS 不一样，可以不需要 JavaScript 参与，当然也可以有 JavaScript 参与，比如在<code>www.b.com/csrf.html</code>中使用 JavaScript 动态生成一个 img 对象：</p><div class="language-html line-numbers-mode" data-highlighter="shiki" data-ext="html" data-title="html" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">script</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> Image</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">src</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;http://www.a.com/blog/del?id=1&#39;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">script</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>同样可以达到攻击效果。需要特别注意的是：这里并不是 JavaScript 跨域操作目标网站 A 的数据，而是间接生成了 img 对象，由 img 对象发起一个合法的跨域 GET 请求而已，这个过程和上面直接用一个 img 标签一样。</p><h3 id="请求是身份认证后的" tabindex="-1"><a class="header-anchor" href="#请求是身份认证后的"><span>请求是身份认证后的</span></a></h3><p>这一点非常关键，跨域发出的请求类似这样：</p><div class="language-request line-numbers-mode" data-highlighter="shiki" data-ext="request" data-title="request" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>GET /blog/del?id=1 HTTP/1.1</span></span>\n<span class="line"><span>Host: www.a.com</span></span>\n<span class="line"><span>User-Agent: Mozilla/5.0 (Windows NT 6.1; rv:5.0) Gecko/20100101 Firefox/5.0</span></span>\n<span class="line"><span>Connection: keep-alive</span></span>\n<span class="line"><span>Referer: http://www.b.com/csrf.html</span></span>\n<span class="line"><span>Cookie:sid=0951abe6d508dab60357804519a61b999;JSESSIONID=abcTePo2Ori_k-pWt5net;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>而如果是目标网站 A，用户自己单击删除链接时发出的请求类似这样：</p><div class="language-request line-numbers-mode" data-highlighter="shiki" data-ext="request" data-title="request" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>GET /blog/del?id=1 HTTP/1.1</span></span>\n<span class="line"><span>Host: www.a.com</span></span>\n<span class="line"><span>User-Agent: Mozilla/5.0 (Windows NT 6.1; rv:5.0) Gecko/20100101 Firefox/5.0</span></span>\n<span class="line"><span>Connection: keep-alive</span></span>\n<span class="line"><span>Referer: http://www.a.com/blog/</span></span>\n<span class="line"><span>Cookie:sid=0951abe6d508dab60357804519a61b999;JSESSIONID=abcTePo2Ori_k-pWt5net;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到这两个请求中，除了请求来源 Referer 值不一样外，其他都一样，尤其是这里的 Cookie 值，该 Cookie 是用户登录目标网站 A 后的身份认证标志。跨域发出的请求同样会带上目标网站 A 的用户 Cookie，这样的请求就是身份认证后的，攻击才会成功。</p><p>通过这个场景，我们知道了 CSRF 的过程，不过这个过程只介绍了 GET 请求的情况，那么 POST 请求呢？比如，目标网站 A 的“写文章”功能，这是一个表单提交的操作，会发起 POST 请求。同样，这个 POST 请求可以从恶意网站 B 中发出，通过 JavaScript 自动生成一份表单，表单的 action 地址指向目标网站 A 的“写文章”表单提交地址，表单的相关字段都准备好后，即可发出请求。下面看一段代码：</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> new_form</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() {</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  var</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> f</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> document</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">createElement</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;iframe&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">  document</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">body</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">appendChild</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">f</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">  f</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">method</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;post&#39;</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> f</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> create_elements</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">eForm</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">eName</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">eValue</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  var</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> e</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> document</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">createElement</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;input&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">  eForm</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">appendChild</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">e</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">  e</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">type</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;text&#39;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">  e</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> eName</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // 兼容浏览器的兼容设置，目的是让表单不可见</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">document</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">all</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">    e</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">style</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">display</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;none&#39;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">    e</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">style</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">display</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;block&#39;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">    e</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">style</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">width</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;0px&#39;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">    e</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">style</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">height</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;0px&#39;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  }</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">  e</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">value</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> eValue</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> e</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">var</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> _f</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> new_form</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">create_elements</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">_f</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;title&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;hi&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">create_elements</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">_f</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;content&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;csrf_here&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">_f</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">action</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;http://www.a.com/blog/add&#39;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">_f</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">submit</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>构造完成，当目标网站 A 的用户被欺骗访问了恶意网站 B 的该页面时，一个跨域的伪造的 POST 表单请求就发出了。同样，这个请求带上了目标网站 A 的用户 Cookie</p><h2 id="csrf-攻击类型" tabindex="-1"><a class="header-anchor" href="#csrf-攻击类型"><span>CSRF 攻击类型</span></a></h2><p>按照请求类型区分，上面介绍的这个场景中其实已经提到，GET 型与 POST 型的 CSRF 攻击。</p><p>若按照攻击方式分类，CSRF 可分为：</p><ul><li>HTML CSRF 攻击</li><li>JSON HiJacking 攻击</li><li>Flash CSRF 攻击<br> 等等</li></ul><h3 id="html-csrf-攻击" tabindex="-1"><a class="header-anchor" href="#html-csrf-攻击"><span>HTML CSRF 攻击</span></a></h3><p>发起的 CSRF 请求都属于 HTML 元素发出的，这一类是最普遍的 CSRF 攻击。如下这些 HTML 元素都可以发出 CSRF 请求。</p><p>HTML 中能够设置 src/href 等链接地址的标签都可以发起 GET 请求，如：</p><ul><li><code>&lt;link href=&quot;&quot;&gt;</code></li><li><code>&lt;img src=&quot;&quot;&gt;</code></li><li><code>&lt;img lowsrc=&quot;&quot;&gt;</code></li><li><code>&lt;img dynsrc=&quot;&quot;&gt;</code></li><li><code>&lt;meta http-equiv=&quot;refresh&quot; content=&quot;0; url=&quot;&gt;</code></li><li><code>&lt;iframe src=&quot;&quot;&gt;</code></li><li><code>&lt;frame src=&quot;&quot;&gt;</code></li><li><code>&lt;script src=&quot;&quot;&gt;</code></li><li><code>&lt;bgsound src=&quot;&quot;&gt;</code></li><li><code>&lt;embed src=&quot;&quot;&gt;</code></li><li><code>&lt;video src=&quot;&quot;&gt;</code></li><li><code>&lt;audio src=&quot;&quot;&gt;</code></li><li><code>&lt;a href=&quot;&quot;&gt;</code></li><li><code>&lt;table background=&quot;&quot;&gt;</code></li><li>...</li></ul><p>CSS 样式中的：</p><ul><li><code>@import &quot;&quot;</code></li><li><code>background: url(&quot;&quot;)</code></li><li>...</li></ul><p>还有通过 JavaScript 动态生成的标签对象或 CSS 对象发起的 GET 请求，而发出 POST 请求只能通过 form 提交方式。</p><h3 id="json-hijacking-攻击" tabindex="-1"><a class="header-anchor" href="#json-hijacking-攻击"><span>JSON HiJacking 攻击</span></a></h3><h3 id="flash-csrf-攻击" tabindex="-1"><a class="header-anchor" href="#flash-csrf-攻击"><span>Flash CSRF 攻击</span></a></h3><p>请查看《Web前端黑客技术揭秘》相关章节</p><h2 id="危害" tabindex="-1"><a class="header-anchor" href="#危害"><span>危害</span></a></h2><ul><li>篡改目标网站上的用户数据</li><li>盗取用户隐私数据</li><li>作为其他攻击向量的辅助攻击手段</li><li>传播 CSRF 蠕虫</li></ul><h2 id="如何防御-csrf-攻击" tabindex="-1"><a class="header-anchor" href="#如何防御-csrf-攻击"><span>如何防御 CSRF 攻击？</span></a></h2><h3 id="csrf-token" tabindex="-1"><a class="header-anchor" href="#csrf-token"><span>CSRF Token</span></a></h3><p>CSRF Token 是一个随机、不可预测的字符串，由服务器（在生成登录态时）生成并发送给客户端（通常是前端页面），客户端在后续向服务器发送敏感请求时，需要将这个 Token 一并发送给服务器，服务器会对该 Token 进行验证，只有验证通过的请求才会被处理。</p><p>CSRF Token 防御 CSRF 攻击的具体过程：</p><p>（1）Token 的生成与下发</p><p>当用户登录目标网站后，服务器会为该用户的本次会话生成一个唯一的、随机的 CSRF Token。这个 Token 通常具有足够的随机性和复杂性，使得攻击者难以猜测。</p><p>服务器会将这个 Token 以某种方式传递给客户端，常见的传递方式有以下两种：</p><ul><li>​​嵌入页面元素​​：将 Token 放在 HTML 页面的<code>&lt;meta&gt;</code>标签中，例如：</li></ul><div class="language-html line-numbers-mode" data-highlighter="shiki" data-ext="html" data-title="html" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">meta</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;csrf-token&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> content</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;your-random-token-value&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>​​通过接口返回​​：在用户登录或页面加载时，服务器通过接口将 Token 作为响应数据返回给前端，前端 JavaScript 代码可以获取并保存这个 Token。</li></ul><p>（2）Token 的携带与发送</p><p>当客户端（前端）需要向服务器发送敏感请求（如 POST、PUT、DELETE 等可能修改服务器数据的请求）时，需要将 CSRF Token 一并发送给服务器。常见的携带方式有：</p><p>​- ​请求头​​：前端可以在请求头中添加一个自定义的字段（如 X-CSRF-Token）来携带 Token。例如，使用 Axios 发送请求时，可以通过请求拦截器添加 Token：</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">axios</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">interceptors</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">request</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">use</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">config</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;"> token</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> document</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">querySelector</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;meta[name=&quot;csrf-token&quot;]&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getAttribute</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;content&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">token</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">        config</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">headers</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;X-CSRF-Token&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> token</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> config</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>​​请求参数​​：也可以将 Token 作为请求参数添加到 URL 或请求体中，不过这种方式相对不太安全，因为 URL 可能会被记录在浏览器历史记录或服务器日志中。</li></ul><p>（3）Token 的验证</p><p>服务器在接收到客户端的请求后，会从请求头、请求参数等指定位置获取客户端发送过来的 CSRF Token。服务器会将这个 Token 与之前为该用户会话生成的 Token 进行比对：</p><ul><li>​​验证通过​​：如果两者一致，说明该请求是来自合法的用户页面，服务器会正常处理该请求。</li><li>​​验证失败​​：如果两者不一致，或者客户端没有携带 Token，服务器会拒绝该请求，并返回相应的错误信息，例如 403 Forbidden 状态码，表示请求被禁止。</li></ul><p>CSRF Token 防御攻击的关键原因</p><ul><li>​​Token 的随机性和不可预测性​​：攻击者无法通过恶意网站预测或获取到目标网站为特定用户生成的 CSRF Token。因为 Token 是在服务器端随机生成的，并且只在服务器和合法用户的浏览器之间传递，攻击者无法通过正常的 HTTP 请求获取到这个 Token。</li><li>​​Token 的本地性​​：CSRF Token 通常存储在用户的浏览器会话中，并且与特定的用户会话相关联。攻击者诱导用户访问的恶意网站无法直接访问该用户的合法会话中的 Token，也就无法在恶意请求中携带正确的 Token。</li><li>​​服务器的严格验证​​：服务器会对每个敏感请求进行严格的 Token 验证，只有携带正确 Token 的请求才会被处理。这就确保了即使攻击者能够诱导用户发起请求，由于请求中不包含正确的 Token，服务器也会拒绝该请求，从而避免了 CSRF 攻击的发生。</li></ul><p>综上所述，CSRF Token 通过生成、下发、携带和验证等一系列机制，有效地防止了攻击者利用用户的已登录状态发起恶意请求，保护了用户和网站的安全。</p><h3 id="检查请求的-referer-origin-头" tabindex="-1"><a class="header-anchor" href="#检查请求的-referer-origin-头"><span>检查请求的 Referer/Origin 头</span></a></h3><p>后端可以校验请求头中的 Referer 或 Origin 字段，确保请求来自合法的源（比如只允许来自 &lt;<a href="https://your-frontend.xn--com-1c4gt15bll5awl2o." target="_blank" rel="noopener noreferrer">https://your-frontend.com的请求）.</a></p><p>但这种方法并不完全可靠，因为某些浏览器或隐私模式下可能不发送 Referer，且容易被伪造（需结合其它方案）。</p><h3 id="关键操作使用-post-表单提交-避免-get-请求执行敏感操作" tabindex="-1"><a class="header-anchor" href="#关键操作使用-post-表单提交-避免-get-请求执行敏感操作"><span>关键操作使用 POST/表单提交，避免 GET 请求执行敏感操作</span></a></h3><p>​​GET 请求容易被滥用​​（比如通过<code>&lt;img src=&quot;...&quot;&gt;</code>、<code>&lt;a href=&quot;...&quot;&gt;</code>触发），不应在 GET 请求中执行如删除、转账等敏感操作。</p><p>敏感操作一定要用 ​​POST/PUT/DELETE​​，并且配合 CSRF Token 校验。</p><h3 id="使用-samesite-cookie-属性-现代浏览器支持" tabindex="-1"><a class="header-anchor" href="#使用-samesite-cookie-属性-现代浏览器支持"><span>使用 SameSite Cookie 属性（现代浏览器支持）</span></a></h3><p>在设置 Cookie 时，可以指定 SameSite属性，限制 Cookie 在跨站请求时不被发送。</p><p>常见取值：</p><ul><li>Strict：完全禁止第三方 Cookie（严格模式，任何跨站请求都不带 Cookie）</li><li>Lax（推荐）：允许部分安全的跨站请求（如导航跳转 GET 请求）携带 Cookie，但阻止大部分恶意跨站 POST 请求</li><li>None：允许跨站发送 Cookie（必须同时设置 Secure，即仅 HTTPS）</li></ul><p>🔒 ​​推荐做法：将身份认证相关的 Cookie 设置为 SameSite=Lax 或 SameSite=Strict，能有效防御大部分 XSRF 攻击。​</p><p>示例（后端设置 Cookie 时）：</p><div class="language-http line-numbers-mode" data-highlighter="shiki" data-ext="http" data-title="http" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Set-Cookie</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sessionId=abc123; SameSite=Lax; Secure; HttpOnly</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div>', 81)),
    createVNode(_component_global_config)
  ]);
}
const csrf_html = /* @__PURE__ */ _export_sfc(_sfc_main, [["render", _sfc_render], ["__file", "csrf.html.vue"]]);
const data = JSON.parse('{"path":"/browser-env/security/csrf.html","title":"CSRF","lang":"en-US","frontmatter":{"description":"CSRF CSRF（Cross-site request forgery）跨站请求伪造，也被称为“One Click Attack”或者“Session Riding”，通常缩写为 CSRF 或者 XSRF，是一种对网站的恶意利用。尽管听起来像跨站脚本（XSS），但它与XSS非常不同，XSS 利用站点内的信任用户，而 CSRF 则通过伪装来自受信任用户...","head":[["meta",{"property":"og:url","content":"https://blog.windstone.cc/browser-env/security/csrf.html"}],["meta",{"property":"og:site_name","content":"风动之石的博客"}],["meta",{"property":"og:title","content":"CSRF"}],["meta",{"property":"og:description","content":"CSRF CSRF（Cross-site request forgery）跨站请求伪造，也被称为“One Click Attack”或者“Session Riding”，通常缩写为 CSRF 或者 XSRF，是一种对网站的恶意利用。尽管听起来像跨站脚本（XSS），但它与XSS非常不同，XSS 利用站点内的信任用户，而 CSRF 则通过伪装来自受信任用户..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2025-10-14T09:14:10.000Z"}],["meta",{"property":"article:modified_time","content":"2025-10-14T09:14:10.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"CSRF\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-10-14T09:14:10.000Z\\",\\"author\\":[]}"]]},"headers":[{"level":2,"title":"示例","slug":"示例","link":"#示例","children":[{"level":3,"title":"跨域发出了一个 GET 请求","slug":"跨域发出了一个-get-请求","link":"#跨域发出了一个-get-请求","children":[]},{"level":3,"title":"可以无 JavaScript 参与","slug":"可以无-javascript-参与","link":"#可以无-javascript-参与","children":[]},{"level":3,"title":"请求是身份认证后的","slug":"请求是身份认证后的","link":"#请求是身份认证后的","children":[]}]},{"level":2,"title":"CSRF 攻击类型","slug":"csrf-攻击类型","link":"#csrf-攻击类型","children":[{"level":3,"title":"HTML CSRF 攻击","slug":"html-csrf-攻击","link":"#html-csrf-攻击","children":[]},{"level":3,"title":"JSON HiJacking 攻击","slug":"json-hijacking-攻击","link":"#json-hijacking-攻击","children":[]},{"level":3,"title":"Flash CSRF 攻击","slug":"flash-csrf-攻击","link":"#flash-csrf-攻击","children":[]}]},{"level":2,"title":"危害","slug":"危害","link":"#危害","children":[]},{"level":2,"title":"如何防御 CSRF 攻击？","slug":"如何防御-csrf-攻击","link":"#如何防御-csrf-攻击","children":[{"level":3,"title":"CSRF Token","slug":"csrf-token","link":"#csrf-token","children":[]},{"level":3,"title":"检查请求的 Referer/Origin 头","slug":"检查请求的-referer-origin-头","link":"#检查请求的-referer-origin-头","children":[]},{"level":3,"title":"关键操作使用 POST/表单提交，避免 GET 请求执行敏感操作","slug":"关键操作使用-post-表单提交-避免-get-请求执行敏感操作","link":"#关键操作使用-post-表单提交-避免-get-请求执行敏感操作","children":[]},{"level":3,"title":"使用 SameSite Cookie 属性（现代浏览器支持）","slug":"使用-samesite-cookie-属性-现代浏览器支持","link":"#使用-samesite-cookie-属性-现代浏览器支持","children":[]}]}],"git":{"createdTime":1517484339000,"updatedTime":1760433250000,"contributors":[{"name":"wind-stone","email":"wind-stone@qq.com","commits":1}]},"readingTime":{"minutes":11.15,"words":3345},"filePathRelative":"browser-env/security/csrf.md","localizedDate":"February 1, 2018","autoDesc":true}');
export {
  csrf_html as comp,
  data
};
