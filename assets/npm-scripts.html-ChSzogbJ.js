import { r as resolveComponent, c as createElementBlock, d as createBaseVNode, f as createTextVNode, a as createVNode, e as withCtx, b as createStaticVNode, o as openBlock } from "./app-DNVdkGQA.js";
import { _ as _export_sfc } from "./plugin-vue_export-helper-1tPrXgE0.js";
const _sfc_main = {};
const _hoisted_1 = { class: "table-of-contents" };
function _sfc_render(_ctx, _cache) {
  const _component_router_link = resolveComponent("router-link");
  const _component_global_config = resolveComponent("global-config");
  return openBlock(), createElementBlock("div", null, [
    _cache[21] || (_cache[21] = createBaseVNode("h1", {
      id: "npm-scripts",
      tabindex: "-1"
    }, [
      createBaseVNode("a", {
        class: "header-anchor",
        href: "#npm-scripts"
      }, [
        createBaseVNode("span", null, "npm-scripts")
      ])
    ], -1)),
    _cache[22] || (_cache[22] = createBaseVNode("p", null, [
      createTextVNode("Copy and tran from "),
      createBaseVNode("a", {
        href: "https://www.npmjs.cn/misc/scripts/",
        target: "_blank",
        rel: "noopener noreferrer"
      }, "npm-scripts")
    ], -1)),
    createBaseVNode("nav", _hoisted_1, [
      createBaseVNode("ul", null, [
        createBaseVNode("li", null, [
          createVNode(_component_router_link, { to: "#描述" }, {
            default: withCtx(() => _cache[0] || (_cache[0] = [
              createTextVNode("描述")
            ])),
            _: 1
          })
        ]),
        createBaseVNode("li", null, [
          createVNode(_component_router_link, { to: "#prepublish-和-prepare" }, {
            default: withCtx(() => _cache[1] || (_cache[1] = [
              createTextVNode("prepublish 和 prepare")
            ])),
            _: 1
          }),
          createBaseVNode("ul", null, [
            createBaseVNode("li", null, [
              createVNode(_component_router_link, { to: "#废弃说明" }, {
                default: withCtx(() => _cache[2] || (_cache[2] = [
                  createTextVNode("废弃说明")
                ])),
                _: 1
              })
            ]),
            createBaseVNode("li", null, [
              createVNode(_component_router_link, { to: "#使用示例" }, {
                default: withCtx(() => _cache[3] || (_cache[3] = [
                  createTextVNode("使用示例")
                ])),
                _: 1
              })
            ])
          ])
        ]),
        createBaseVNode("li", null, [
          createVNode(_component_router_link, { to: "#默认值" }, {
            default: withCtx(() => _cache[4] || (_cache[4] = [
              createTextVNode("默认值")
            ])),
            _: 1
          })
        ]),
        createBaseVNode("li", null, [
          createVNode(_component_router_link, { to: "#用户" }, {
            default: withCtx(() => _cache[5] || (_cache[5] = [
              createTextVNode("用户")
            ])),
            _: 1
          })
        ]),
        createBaseVNode("li", null, [
          createVNode(_component_router_link, { to: "#环境" }, {
            default: withCtx(() => _cache[6] || (_cache[6] = [
              createTextVNode("环境")
            ])),
            _: 1
          }),
          createBaseVNode("ul", null, [
            createBaseVNode("li", null, [
              createVNode(_component_router_link, { to: "#path" }, {
                default: withCtx(() => _cache[7] || (_cache[7] = [
                  createTextVNode("path")
                ])),
                _: 1
              })
            ]),
            createBaseVNode("li", null, [
              createVNode(_component_router_link, { to: "#package-json-变量" }, {
                default: withCtx(() => _cache[8] || (_cache[8] = [
                  createTextVNode("package.json 变量")
                ])),
                _: 1
              })
            ]),
            createBaseVNode("li", null, [
              createVNode(_component_router_link, { to: "#配置" }, {
                default: withCtx(() => _cache[9] || (_cache[9] = [
                  createTextVNode("配置")
                ])),
                _: 1
              })
            ]),
            createBaseVNode("li", null, [
              createVNode(_component_router_link, { to: "#特殊-package-json-里的-config-对象" }, {
                default: withCtx(() => _cache[10] || (_cache[10] = [
                  createTextVNode("特殊: package.json 里的 config 对象")
                ])),
                _: 1
              })
            ]),
            createBaseVNode("li", null, [
              createVNode(_component_router_link, { to: "#生命周期事件" }, {
                default: withCtx(() => _cache[11] || (_cache[11] = [
                  createTextVNode("生命周期事件")
                ])),
                _: 1
              })
            ])
          ])
        ]),
        createBaseVNode("li", null, [
          createVNode(_component_router_link, { to: "#示例" }, {
            default: withCtx(() => _cache[12] || (_cache[12] = [
              createTextVNode("示例")
            ])),
            _: 1
          })
        ]),
        createBaseVNode("li", null, [
          createVNode(_component_router_link, { to: "#退出" }, {
            default: withCtx(() => _cache[13] || (_cache[13] = [
              createTextVNode("退出")
            ])),
            _: 1
          })
        ]),
        createBaseVNode("li", null, [
          createVNode(_component_router_link, { to: "#钩子脚本" }, {
            default: withCtx(() => _cache[14] || (_cache[14] = [
              createTextVNode("钩子脚本")
            ])),
            _: 1
          })
        ]),
        createBaseVNode("li", null, [
          createVNode(_component_router_link, { to: "#最佳实践" }, {
            default: withCtx(() => _cache[15] || (_cache[15] = [
              createTextVNode("最佳实践")
            ])),
            _: 1
          })
        ]),
        createBaseVNode("li", null, [
          createVNode(_component_router_link, { to: "#补充知识" }, {
            default: withCtx(() => _cache[16] || (_cache[16] = [
              createTextVNode("补充知识")
            ])),
            _: 1
          }),
          createBaseVNode("ul", null, [
            createBaseVNode("li", null, [
              createVNode(_component_router_link, { to: "#npm-run" }, {
                default: withCtx(() => _cache[17] || (_cache[17] = [
                  createTextVNode("npm run")
                ])),
                _: 1
              })
            ]),
            createBaseVNode("li", null, [
              createVNode(_component_router_link, { to: "#npm-run-env" }, {
                default: withCtx(() => _cache[18] || (_cache[18] = [
                  createTextVNode("npm run env")
                ])),
                _: 1
              })
            ]),
            createBaseVNode("li", null, [
              createVNode(_component_router_link, { to: "#npm-scripts-参数" }, {
                default: withCtx(() => _cache[19] || (_cache[19] = [
                  createTextVNode("npm scripts 参数")
                ])),
                _: 1
              }),
              createBaseVNode("ul", null, [
                createBaseVNode("li", null, [
                  createVNode(_component_router_link, { to: "#方式一" }, {
                    default: withCtx(() => _cache[20] || (_cache[20] = [
                      createTextVNode("方式一")
                    ])),
                    _: 1
                  })
                ])
              ])
            ])
          ])
        ])
      ])
    ]),
    _cache[23] || (_cache[23] = createStaticVNode('<h2 id="描述" tabindex="-1"><a class="header-anchor" href="#描述"><span>描述</span></a></h2><p><code>npm</code>支持<code>package.json</code>文件里的<code>scripts</code>属性的以下脚本：</p><ul><li><code>prepublish</code>: 在包（<code>package</code>）打包发布之前运行，也在本地不带任何参数执行<code>npm install</code>时运行。（见下方）</li><li><code>prepare</code>: 在包打包发布之前运行，也在本地不带任何参数执行<code>npm install</code>时运行，以及在安装<code>git</code>依赖时运行（见下方）。<code>prepare</code>会在<code>prepublish</code>之后运行，但是在<code>prepublishOnly</code>之前运行。</li><li><code>prepublishOnly</code>: 在包打包发布之前运行，仅在<code>npm publish</code>时。（见下方）</li><li><code>prepack</code>: 在原始码（<code>tarball</code>）被打包（在<code>npm pack</code>、<code>npm publish</code>以及安装<code>git</code>依赖时）之前运行。</li><li><code>postpack</code>: 在原始码（<code>tarball</code>）被生成和移动到最终的目的地之后运行。</li><li><code>publish</code>、<code>postpublish</code>: 在包被发布之后运行。</li><li><code>preinstall</code>: 在包安装依赖之前运行。</li><li><code>install</code>、<code>postinstall</code>: 在包安装依赖之后运行。</li><li><code>preuninstall</code>、<code>uninstall</code>: 在包卸载依赖之前运行。</li><li><code>postuninstall</code>: 在包安装依赖之后运行。</li><li><code>preversion</code>: 升级包的版本之前运行。</li><li><code>version</code>: 升级包的版本之后运行，但是在提交之前。</li><li><code>postversion</code>: 在升级包的版本之后运行，但是在提交之后。</li><li><code>pretest</code>、<code>test</code>、<code>posttest</code>: 分别在<code>npm test</code>之前、之时、之后运行。</li><li><code>prestop</code>、<code>stop</code>、<code>poststop</code>: 分别在<code>npm stop</code>之前、之时、之后运行。</li><li><code>prestart</code>、<code>start</code>、<code>poststart</code>: 分别在<code>npm start</code>之前、之时、之后运行。</li><li><code>prerestart</code>、<code>restart</code>、<code>postrestart</code>: 分别在<code>npm restart</code>之前、之时、之后运行。注意，若是未提供<code>restart</code>脚本，<code>npm restart</code>将运行<code>stop</code>脚本和<code>start</code>脚本。</li><li><code>preshrinkwrap</code>、<code>shrinkwrap</code>、<code>postshrinkwrap</code>: 分别在<code>npm shrinkwrap</code>之前、之时、之后运行。</li></ul><p>此外，可以通过运行<code>npm run-script &lt;stage&gt;</code>来执行任意脚本。匹配名称的<code>pre</code>和<code>post</code>命令也会运行（比如，<code>premyscript</code>、<code>myscript</code>、<code>postmyscript</code>）。依赖里的脚本可以通过<code>npm explore &lt;pkg&gt; -- npm run &lt;stage&gt;</code>来运行。</p><h2 id="prepublish-和-prepare" tabindex="-1"><a class="header-anchor" href="#prepublish-和-prepare"><span>prepublish 和 prepare</span></a></h2><h3 id="废弃说明" tabindex="-1"><a class="header-anchor" href="#废弃说明"><span>废弃说明</span></a></h3><p>自从<code>npm@1.1.71</code>以来，<code>npm</code>的 CLI 会同时为<code>npm publish</code>和<code>npm install</code>运行<code>prepublish</code>脚本，因为这是一个便利的方式以在使用包之前做一些准备工作（一些常用的使用示例将在之后的部分介绍）。但在实践中，这会特别令人困惑。在<code>npm@4.0.0</code>，一个新的事件<code>prepare</code>被引入（来替代<code>prepublish</code>），且之前已存在的行为（即<code>prepublish</code>脚本）也被保留了。一个仅在<code>npm publish</code>时运行（比如，最后一次运行测试以确保其处于良好的状态）的新事件<code>prepublishOnly</code>作为过渡性策略被添加，以允许用户避开已存在的<code>npm</code>版本的困惑行为。</p><p>参见<a href="https://github.com/npm/npm/issues/10074" target="_blank" rel="noopener noreferrer">https://github.com/npm/npm/issues/10074</a>可了解关于这个改变的更深入原因。</p><h3 id="使用示例" tabindex="-1"><a class="header-anchor" href="#使用示例"><span>使用示例</span></a></h3><p>若是你需要在包被使用之前执行一些不依赖于操作系统或者目标系统体系结构的操作，则可以使用<code>prepublish</code>脚本。比如如下一些任务:</p><ul><li>将 CoffeeScript 源码编译为 JavaScript。</li><li>创建 JavaScript 源码的压缩版。</li><li>抓取你的包将使用到的远程资源。</li></ul><p>在<code>prepublish</code>阶段做这些事情的优势是可以在单一地方一次完成，以减少复杂性和可变性。此外，这意味着:</p><ul><li>你可以将<code>coffee-script</code>作为开发依赖<code>devDependency</code>，因此你的用户不需要已经安装<code>coffee-script</code>。</li><li>你不需要在你的包里包含压缩器<code>minifier</code>。</li><li>你不需要依赖你的用户在目标机器上有<code>curl</code>或<code>wget</code>或其他系统工具。</li></ul><h2 id="默认值" tabindex="-1"><a class="header-anchor" href="#默认值"><span>默认值</span></a></h2><p><code>npm</code>会基于包的内容设置一些脚本的默认值。</p><ul><li><code>start</code>: <code>node server.js</code>。若是在包的根目录下有<code>server.js</code>文件，则<code>npm</code>默认会将<code>start</code>命令设置为<code>node server.js</code>。</li><li><code>install</code>: <code>node-gyp rebuild</code>。若是在包的根目录下有<code>binding.gyp</code>文件，且你没有定义自己的<code>install</code>和<code>preinstall</code>脚本，则<code>npm</code>默认会将<code>install</code>命令设置为<code>node-gyp rebuild</code>。</li></ul><h2 id="用户" tabindex="-1"><a class="header-anchor" href="#用户"><span>用户</span></a></h2><p>若是<code>npm</code>以<code>root</code>权限调用，则它会将<code>uid</code>改为用户账号或者用户配置里指定的<code>uid</code>，默认为<code>nobody</code>。设置<code>unsafe-perm</code>标志以使用<code>root</code>权限运行脚本。</p><h2 id="环境" tabindex="-1"><a class="header-anchor" href="#环境"><span>环境</span></a></h2><p>包的脚本运行的环境里，有大量关于<code>npm</code>设置和进程的当前状态的信息可以使用。</p><h3 id="path" tabindex="-1"><a class="header-anchor" href="#path"><span>path</span></a></h3><p>若你依赖了定义了可执行脚本的模块，比如测试套件，则这些可执行的脚本会被加入到<code>PATH</code>以执行这些脚本。因此，若是你的<code>package.json</code>是这样:</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    &quot;name&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> : </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;foo&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    &quot;dependencies&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: {</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        &quot;bar&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> : </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;0.1.x&quot;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    },</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    &quot;scripts&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: {</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        &quot;start&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> : </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;bar ./test&quot;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>则你可以运行<code>npm start</code>去执行<code>bar</code>脚本，<code>bar</code>脚本在执行<code>npm install</code>时就输出到了<code>node_modules/.bin</code>目录里。</p><h3 id="package-json-变量" tabindex="-1"><a class="header-anchor" href="#package-json-变量"><span>package.json 变量</span></a></h3><p><code>package.json</code>文件里的各个属性都以<code>npm_package_</code>前缀的显示存在在环境里。因此，若是你<code>package.json</code>文件里有<code>{&quot;name&quot;: &quot;foo&quot;, &quot;version&quot;: &quot;1.2.5&quot;}</code>，则你的包的脚本里的<code>npm_package_name</code>环境变量的值则为<code>foo</code>，<code>npm_package_version</code>环境变量的值则为<code>1.2.5</code>。你可以在代码里使用<code>process.env.npm_package_name</code>和<code>process.env.npm_package_version</code>访问这些变量，<code>package.json</code>文件里的其他属性也是这样。</p><h3 id="配置" tabindex="-1"><a class="header-anchor" href="#配置"><span>配置</span></a></h3><p>配置参数是以<code>npm_config_</code>为前缀放入环境里的。比如，你可以通过检查<code>npm_config_root</code>环境变量来查看有效的<code>root</code>配置。</p><h3 id="特殊-package-json-里的-config-对象" tabindex="-1"><a class="header-anchor" href="#特殊-package-json-里的-config-对象"><span>特殊: package.json 里的 config 对象</span></a></h3><p>若是存在<code>&lt;name&gt;[@&lt;version&gt;]:&lt;key&gt;</code>形式的配置参数，则在环境里，<code>package.json</code>文件里的<code>config</code>对象会被覆盖。比如，若是<code>package.json</code>是这样:</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    &quot;name&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;foo&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    &quot;config&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: {</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        &quot;port&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;8080&quot;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    },</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    &quot;scripts&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: {</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        &quot;start&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;node server.js&quot;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>server.js</code>是这样的:</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">http</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;">...</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">env</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">npm_package_config_port</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>则用户可以通过以下方式改变这个行为:</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">npm</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> config</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> set</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> foo:port</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 80</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="生命周期事件" tabindex="-1"><a class="header-anchor" href="#生命周期事件"><span>生命周期事件</span></a></h3><p>最后，<code>npm_lifecycle_event</code>环境变量会被设置为正在执行的周期阶段。因此，你可以将单个脚本用于进程的不同阶段，这将基于当前阶段进行切换。</p><p>对象将以这种方式打平，因此你的<code>package.json</code>里要是有<code>{&quot;scripts&quot;: {&quot;install&quot;: &quot;foo.js&quot;}}</code>，则你将在脚本里得到:</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">env</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">npm_package_scripts_install</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;foo.js&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="示例" tabindex="-1"><a class="header-anchor" href="#示例"><span>示例</span></a></h2><p>比如，若是你的<code>package.json</code>包含如下内容:</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    &quot;scripts&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: {</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        &quot;install&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;scripts/install.js&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        &quot;postinstall&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;scripts/install.js&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        &quot;uninstall&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;scripts/uninstall.js&quot;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>则<code>scripts/install.js</code>将在生命周期的<code>install</code>和<code>post-install</code>阶段调用，<code>scripts/uninstall.js</code>将在包<code>uninstall</code>的时候调用。由于<code>scripts/install.js</code>在两个不同的阶段运行，因此可通过<code>npm_lifecycle_event</code>环境变量来判断处于哪个阶段。</p><p>若是你想执行<code>make</code>命令，你可以这样做，这同时可以工作:</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    &quot;scripts&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: {</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        &quot;preinstall&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> : </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;./configure&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        &quot;install&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> : </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;make &amp;&amp; make install&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        &quot;test&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> : </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;make test&quot;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="退出" tabindex="-1"><a class="header-anchor" href="#退出"><span>退出</span></a></h2><p>脚本是将整行作为脚本参数传递给<code>sh</code>命令来运行的。</p><p>若是脚本以非 0 的<code>code</code>退出，则将停止进程。</p><p>需要注意的是，这些脚本文件不一定必须是<code>nodejs</code>甚至是 JavaScript 程序。它们只要是某种可执行的文件即可。</p><h2 id="钩子脚本" tabindex="-1"><a class="header-anchor" href="#钩子脚本"><span>钩子脚本</span></a></h2><p>若是你想要为所有的包在指定生命周期事件时运行指定的脚本，则你可以使用钩子脚本。将可执行文件放置在<code>node_modules/.hooks/{eventname}</code>，则针对任何安装在那个根目录下的包，当这些包经历了该包生命周期里的该阶段时，这个脚本都会执行。</p><p>钩子脚本的运行与<code>package.json</code>里的脚本完全一样。但它们是在分离的子进程里运行，都有上述描述的环境。</p><h2 id="最佳实践" tabindex="-1"><a class="header-anchor" href="#最佳实践"><span>最佳实践</span></a></h2><ul><li>不要以非 0 的错误码退出，除非你真的了解它。除了<code>uninstall</code>脚本，这将引起<code>npm</code>行为的失败，以及存在被回滚的可能。若是这种失败是微小的或只是阻止了一些可选的特性，则更好的方式是仅仅打印一个警告，并成功退出。</li><li>不要尝试使用脚本去做<code>npm</code>能帮你做的事情。读一下<a href="https://www.npmjs.cn/files/package.json/" target="_blank" rel="noopener noreferrer">package.json</a>，看看所有通过简单、适当地描述你的包就能指定和开启的事情。通常，这样会更加方便和可靠。</li><li>检查环境以确定将文件放置在何处。比如，若是<code>npm_config_binroot</code>环境变量设置为<code>/home/user/bin</code>，则不要试图往<code>/usr/local/bin</code>里安装可执行文件。用户如此设置可能是有理由的。</li><li>不要以<code>sudo</code>前缀执行你的脚本命令。若是因为一些原因需要<code>root</code>权限，且因为没有<code>root</code>权限而失败，则用户将根据提示切换权限来执行<code>npm</code>命令。</li><li>不要使用<code>install</code>脚本。使用一个<code>.gyp</code>文件来编译，其他任何情况都使用<code>prepublish</code>。你几乎应该从来不要明确地设置<code>preinstall</code>或<code>install</code>脚本。若是你设置了，请考虑下是否有其他的选择。唯一合理地使用<code>install</code>或<code>preinstall</code>脚本，是为了要在目标体系结构里必须要完成某项编译的情况下。</li></ul><h2 id="补充知识" tabindex="-1"><a class="header-anchor" href="#补充知识"><span>补充知识</span></a></h2><p>Reference: <a href="http://www.ruanyifeng.com/blog/2016/10/npm_scripts.html" target="_blank" rel="noopener noreferrer">阮一峰 - npm scripts 使用指南</a></p><h3 id="npm-run" tabindex="-1"><a class="header-anchor" href="#npm-run"><span>npm run</span></a></h3><p>不带参数执行<code>npm run</code>命令，可以查看当前项目的所有<code>npm</code>脚本命令:</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">➜</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  blog</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> git:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">master</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">npm</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> run</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Lifecycle</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> scripts</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> included</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> in</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> blog:</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  start</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    npm</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> run</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dev</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">available</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> via</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> `</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">npm</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> run-script`</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">:</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  dev</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    vuepress</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dev</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> docs</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  build</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    vuepress</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> build</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> docs</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  deploy</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    sh</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> deploy.sh</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  eslint</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    sh</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> eslint.sh</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="npm-run-env" tabindex="-1"><a class="header-anchor" href="#npm-run-env"><span>npm run env</span></a></h3><p>你可以运行<code>npm run env</code>（类 Unix 下）或<code>npm run env-windows</code>（Windows 下）查看所有的环境变量。</p><h3 id="npm-scripts-参数" tabindex="-1"><a class="header-anchor" href="#npm-scripts-参数"><span>npm scripts 参数</span></a></h3><h4 id="方式一" tabindex="-1"><a class="header-anchor" href="#方式一"><span>方式一</span></a></h4><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    &quot;scripts&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: {</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        &quot;build&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;node version.js -v ${V}&quot;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 执行此行命令，实际执行的是 node version.js -v 123456</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">V</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">123456</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> npm</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> run</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> build</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>详见: <a href="https://www.zhihu.com/question/54471504/answer/139521430" target="_blank" rel="noopener noreferrer">npm run 执行package.json中的scripts配置时如何参数传递？ - 草依山的回答 - 知乎</a></p>', 66)),
    createVNode(_component_global_config)
  ]);
}
const npmScripts_html = /* @__PURE__ */ _export_sfc(_sfc_main, [["render", _sfc_render], ["__file", "npm-scripts.html.vue"]]);
const data = JSON.parse('{"path":"/front-end-engineering/environment/package-manager/npm/npm-scripts.html","title":"npm-scripts","lang":"en-US","frontmatter":{"description":"npm-scripts Copy and tran from npm-scripts 描述 npm支持package.json文件里的scripts属性的以下脚本： prepublish: 在包（package）打包发布之前运行，也在本地不带任何参数执行npm install时运行。（见下方） prepare: 在包打包发布之前运行，也在本地不带任何参...","head":[["meta",{"property":"og:url","content":"https://blog.windstone.cc/front-end-engineering/environment/package-manager/npm/npm-scripts.html"}],["meta",{"property":"og:site_name","content":"风动之石的博客"}],["meta",{"property":"og:title","content":"npm-scripts"}],["meta",{"property":"og:description","content":"npm-scripts Copy and tran from npm-scripts 描述 npm支持package.json文件里的scripts属性的以下脚本： prepublish: 在包（package）打包发布之前运行，也在本地不带任何参数执行npm install时运行。（见下方） prepare: 在包打包发布之前运行，也在本地不带任何参..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2024-10-31T12:47:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-10-31T12:47:00.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"npm-scripts\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-10-31T12:47:00.000Z\\",\\"author\\":[]}"]]},"headers":[{"level":2,"title":"描述","slug":"描述","link":"#描述","children":[]},{"level":2,"title":"prepublish 和 prepare","slug":"prepublish-和-prepare","link":"#prepublish-和-prepare","children":[{"level":3,"title":"废弃说明","slug":"废弃说明","link":"#废弃说明","children":[]},{"level":3,"title":"使用示例","slug":"使用示例","link":"#使用示例","children":[]}]},{"level":2,"title":"默认值","slug":"默认值","link":"#默认值","children":[]},{"level":2,"title":"用户","slug":"用户","link":"#用户","children":[]},{"level":2,"title":"环境","slug":"环境","link":"#环境","children":[{"level":3,"title":"path","slug":"path","link":"#path","children":[]},{"level":3,"title":"package.json 变量","slug":"package-json-变量","link":"#package-json-变量","children":[]},{"level":3,"title":"配置","slug":"配置","link":"#配置","children":[]},{"level":3,"title":"特殊: package.json 里的 config 对象","slug":"特殊-package-json-里的-config-对象","link":"#特殊-package-json-里的-config-对象","children":[]},{"level":3,"title":"生命周期事件","slug":"生命周期事件","link":"#生命周期事件","children":[]}]},{"level":2,"title":"示例","slug":"示例","link":"#示例","children":[]},{"level":2,"title":"退出","slug":"退出","link":"#退出","children":[]},{"level":2,"title":"钩子脚本","slug":"钩子脚本","link":"#钩子脚本","children":[]},{"level":2,"title":"最佳实践","slug":"最佳实践","link":"#最佳实践","children":[]},{"level":2,"title":"补充知识","slug":"补充知识","link":"#补充知识","children":[{"level":3,"title":"npm run","slug":"npm-run","link":"#npm-run","children":[]},{"level":3,"title":"npm run env","slug":"npm-run-env","link":"#npm-run-env","children":[]},{"level":3,"title":"npm scripts 参数","slug":"npm-scripts-参数","link":"#npm-scripts-参数","children":[]}]}],"git":{"createdTime":1570434741000,"updatedTime":1730378820000,"contributors":[{"name":"wind-stone","email":"wind-stone@qq.com","commits":1}]},"readingTime":{"minutes":7.78,"words":2333},"filePathRelative":"front-end-engineering/environment/package-manager/npm/npm-scripts.md","localizedDate":"October 7, 2019","autoDesc":true}');
export {
  npmScripts_html as comp,
  data
};
